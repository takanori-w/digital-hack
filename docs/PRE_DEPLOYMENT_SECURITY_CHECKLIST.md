# LifePlan Navigator - 本番デプロイ前セキュリティチェックリスト

**バージョン**: 1.0
**作成日**: 2025-12-11
**対象者**: DevOps, Network Engineer, CISO, CTO
**分類**: 内部機密

---

## 概要

本チェックリストは、LifePlan Navigator を本番環境にデプロイする前に完了すべきセキュリティ項目を定義します。
全項目の確認・承認が完了するまで、本番デプロイは禁止されます。

---

## 1. コードセキュリティ

### 1.1 静的解析 (SAST)

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 1.1.1 | ESLint セキュリティルール全パス | App Engineer | | ☐ |
| 1.1.2 | TypeScript strict mode 有効 | App Engineer | | ☐ |
| 1.1.3 | `npm audit` で重大な脆弱性なし | DevOps | | ☐ |
| 1.1.4 | Snyk/Dependabot スキャン完了 | DevOps | | ☐ |
| 1.1.5 | シークレットのハードコードなし | App Engineer | | ☐ |

### 1.2 コードレビュー

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 1.2.1 | CSRF対策の修正完了（VER-001） | White Hacker | | ☐ |
| 1.2.2 | LocalStorage機密情報除去（VULN-001） | White Hacker | | ☐ |
| 1.2.3 | 入力バリデーション実装（VULN-005） | App Engineer | | ☐ |
| 1.2.4 | XSSサニタイゼーション実装（VULN-002） | App Engineer | | ☐ |
| 1.2.5 | エラーハンドリング適切（VULN-007） | App Engineer | | ☐ |

### 1.3 依存関係

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 1.3.1 | Critical 脆弱性: 0件 | DevOps | | ☐ |
| 1.3.2 | High 脆弱性: 0件 | DevOps | | ☐ |
| 1.3.3 | Medium 脆弱性: 例外承認済み or 0件 | CISO | | ☐ |
| 1.3.4 | 不要な依存関係削除済み | App Engineer | | ☐ |
| 1.3.5 | package-lock.json 最新 | DevOps | | ☐ |

---

## 2. 認証・認可

### 2.1 認証

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 2.1.1 | パスワードはArgon2idでハッシュ化 | App Engineer | | ☐ |
| 2.1.2 | パスワードポリシー: 12文字以上、複雑性必須 | App Engineer | | ☐ |
| 2.1.3 | 漏洩パスワードチェック (HIBP) 有効 | App Engineer | | ☐ |
| 2.1.4 | アカウントロック: 5回失敗で15分ロック | App Engineer | | ☐ |
| 2.1.5 | MFA (TOTP) 実装済み | App Engineer | | ☐ |

### 2.2 セッション

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 2.2.1 | セッションID: 256bit CSPRNG | App Engineer | | ☐ |
| 2.2.2 | アイドルタイムアウト: 30分 | App Engineer | | ☐ |
| 2.2.3 | 絶対タイムアウト: 8時間 | App Engineer | | ☐ |
| 2.2.4 | ログイン後セッションID再生成 | App Engineer | | ☐ |
| 2.2.5 | Cookie: Secure, HttpOnly, SameSite=Strict | App Engineer | | ☐ |

### 2.3 認可

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 2.3.1 | RBAC実装完了 | App Engineer | | ☐ |
| 2.3.2 | 全APIエンドポイントで認可チェック | White Hacker | | ☐ |
| 2.3.3 | IDOR対策実装 | White Hacker | | ☐ |
| 2.3.4 | 最小権限の原則適用 | CISO | | ☐ |

---

## 3. データ保護

### 3.1 暗号化

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 3.1.1 | TLS 1.3 有効（TLS 1.2以下は無効） | Network Engineer | | ☐ |
| 3.1.2 | HSTS有効 (max-age=31536000, includeSubDomains) | Network Engineer | | ☐ |
| 3.1.3 | SSL証明書: 有効期限30日以上 | Network Engineer | | ☐ |
| 3.1.4 | データベース暗号化 (AES-256) | DevOps | | ☐ |
| 3.1.5 | 機密カラム: アプリレベル暗号化 | App Engineer | | ☐ |
| 3.1.6 | 暗号化キー: KMS/HSMで管理 | DevOps | | ☐ |

### 3.2 データ分類

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 3.2.1 | 機密データの特定・分類完了 | CISO | | ☐ |
| 3.2.2 | PIIマスキング実装（ログ） | App Engineer | | ☐ |
| 3.2.3 | 本番環境にモックデータなし | DevOps | | ☐ |
| 3.2.4 | バックアップ暗号化 | DevOps | | ☐ |

---

## 4. アプリケーションセキュリティ

### 4.1 セキュリティヘッダー

| # | ヘッダー | 期待値 | 確認者 | 状態 |
|---|----------|--------|--------|------|
| 4.1.1 | Content-Security-Policy | default-src 'self'; ... | Network Engineer | ☐ |
| 4.1.2 | X-Frame-Options | DENY | Network Engineer | ☐ |
| 4.1.3 | X-Content-Type-Options | nosniff | Network Engineer | ☐ |
| 4.1.4 | Referrer-Policy | strict-origin-when-cross-origin | Network Engineer | ☐ |
| 4.1.5 | Permissions-Policy | camera=(), microphone=(), geolocation=() | Network Engineer | ☐ |
| 4.1.6 | Strict-Transport-Security | max-age=31536000; includeSubDomains; preload | Network Engineer | ☐ |

### 4.2 本番設定

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 4.2.1 | CSP: unsafe-inline/unsafe-eval除去 | Network Engineer | | ☐ |
| 4.2.2 | CSP: connect-src からlocalhost除去 | Network Engineer | | ☐ |
| 4.2.3 | デバッグモード無効 | DevOps | | ☐ |
| 4.2.4 | ソースマップ非公開 | DevOps | | ☐ |
| 4.2.5 | エラーメッセージ: スタックトレースなし | App Engineer | | ☐ |
| 4.2.6 | サーバー情報ヘッダー除去 | Network Engineer | | ☐ |

### 4.3 入力検証

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 4.3.1 | サーバーサイドバリデーション実装 | App Engineer | | ☐ |
| 4.3.2 | ホワイトリスト方式での検証 | App Engineer | | ☐ |
| 4.3.3 | 文字エンコーディング: UTF-8統一 | App Engineer | | ☐ |
| 4.3.4 | ファイルアップロード: 種類・サイズ制限 | App Engineer | | ☐ |

---

## 5. インフラストラクチャ

### 5.1 ネットワーク

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 5.1.1 | WAF有効 (OWASP CRS) | Network Engineer | | ☐ |
| 5.1.2 | DDoS保護有効 | Network Engineer | | ☐ |
| 5.1.3 | 3層ネットワーク分離 (DMZ, App, Data) | Network Engineer | | ☐ |
| 5.1.4 | データベース: インターネット非公開 | Network Engineer | | ☐ |
| 5.1.5 | セキュリティグループ: 最小限のポート | Network Engineer | | ☐ |
| 5.1.6 | VPCフローログ有効 | Network Engineer | | ☐ |

### 5.2 サーバー

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 5.2.1 | OSパッチ最新 | DevOps | | ☐ |
| 5.2.2 | 不要なサービス無効 | DevOps | | ☐ |
| 5.2.3 | SSH: キー認証のみ | DevOps | | ☐ |
| 5.2.4 | SSH: root ログイン禁止 | DevOps | | ☐ |
| 5.2.5 | ファイアウォール設定済み | Network Engineer | | ☐ |

### 5.3 コンテナ/Kubernetes

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 5.3.1 | ベースイメージ: 脆弱性なし | DevOps | | ☐ |
| 5.3.2 | 非rootユーザーで実行 | DevOps | | ☐ |
| 5.3.3 | リソース制限設定 | DevOps | | ☐ |
| 5.3.4 | NetworkPolicy設定 | Network Engineer | | ☐ |
| 5.3.5 | SecretはK8s Secrets/外部KMSで管理 | DevOps | | ☐ |

---

## 6. ログ・監視

### 6.1 ログ収集

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 6.1.1 | アプリケーションログ収集設定 | SOC Analyst | | ☐ |
| 6.1.2 | 認証ログ収集設定 | SOC Analyst | | ☐ |
| 6.1.3 | アクセスログ収集設定 | SOC Analyst | | ☐ |
| 6.1.4 | エラーログ収集設定 | SOC Analyst | | ☐ |
| 6.1.5 | ログにPII含まない（マスキング済み） | App Engineer | | ☐ |
| 6.1.6 | ログ改ざん防止 (WORM/署名) | DevOps | | ☐ |

### 6.2 監視・アラート

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 6.2.1 | SIEM連携設定 | SOC Analyst | | ☐ |
| 6.2.2 | 異常検知ルール設定 | SOC Analyst | | ☐ |
| 6.2.3 | ログイン失敗アラート設定 | SOC Analyst | | ☐ |
| 6.2.4 | 大量データエクスポートアラート設定 | SOC Analyst | | ☐ |
| 6.2.5 | WAFブロックアラート設定 | SOC Analyst | | ☐ |
| 6.2.6 | インシデント対応手順書準備 | CSIRT Leader | | ☐ |

---

## 7. バックアップ・DR

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 7.1 | 日次バックアップ設定 | DevOps | | ☐ |
| 7.2 | バックアップ暗号化 | DevOps | | ☐ |
| 7.3 | バックアップリストアテスト完了 | DevOps | | ☐ |
| 7.4 | 地理的分散 (別リージョン) | DevOps | | ☐ |
| 7.5 | RPO: 1時間以内達成可能 | DevOps | | ☐ |
| 7.6 | RTO: 4時間以内達成可能 | DevOps | | ☐ |

---

## 8. セキュリティテスト

### 8.1 自動テスト

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 8.1.1 | ユニットテスト: 100%パス | App Engineer | | ☐ |
| 8.1.2 | セキュリティテスト: 100%パス | White Hacker | | ☐ |
| 8.1.3 | E2Eテスト: 100%パス | QA | | ☐ |
| 8.1.4 | DAST (動的解析): 重大な問題なし | White Hacker | | ☐ |

### 8.2 手動テスト

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 8.2.1 | ペネトレーションテスト完了 | White Hacker | | ☐ |
| 8.2.2 | Critical脆弱性: 0件 | White Hacker | | ☐ |
| 8.2.3 | High脆弱性: 0件 | White Hacker | | ☐ |
| 8.2.4 | Medium脆弱性: 例外承認済み or 修正済み | CISO | | ☐ |

---

## 9. コンプライアンス

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 9.1 | プライバシーポリシー公開 | CLO | | ☐ |
| 9.2 | 利用規約公開 | CLO | | ☐ |
| 9.3 | Cookie同意バナー実装 | App Engineer | | ☐ |
| 9.4 | データ削除機能実装（忘れられる権利） | App Engineer | | ☐ |
| 9.5 | 漏洩時報告手順準備 | CLO | | ☐ |

---

## 10. シークレット管理

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 10.1 | 本番シークレット: KMS/Secrets Managerで管理 | DevOps | | ☐ |
| 10.2 | APIキー: 本番用に更新 | DevOps | | ☐ |
| 10.3 | データベース認証情報: 本番用 | DevOps | | ☐ |
| 10.4 | 暗号化キー: 本番用に生成 | DevOps | | ☐ |
| 10.5 | シークレットローテーション計画策定 | CISO | | ☐ |

---

## 11. 環境変数チェック

### 11.1 必須環境変数

```bash
# 以下の環境変数が本番用に設定されていることを確認

# アプリケーション
NODE_ENV=production
NEXTAUTH_URL=https://lifeplan-navigator.jp
NEXTAUTH_SECRET=[32文字以上の安全な値]

# データベース
DATABASE_URL=[本番DB接続文字列]

# Redis
REDIS_URL=[本番Redis接続文字列]

# 暗号化
ENCRYPTION_KEY=[32バイトの安全な値]

# OAuth
GOOGLE_CLIENT_ID=[本番用]
GOOGLE_CLIENT_SECRET=[本番用]
```

### 11.2 禁止事項

| # | チェック項目 | 確認者 | 完了日 | 状態 |
|---|-------------|--------|--------|------|
| 11.2.1 | .env ファイルがコミットされていない | DevOps | | ☐ |
| 11.2.2 | ハードコードされたシークレットなし | DevOps | | ☐ |
| 11.2.3 | localhostの参照なし | DevOps | | ☐ |
| 11.2.4 | デバッグ用コード削除済み | App Engineer | | ☐ |

---

## 12. 承認フロー

### 12.1 承認者

| 承認段階 | 承認者 | 承認条件 | 署名 | 日付 |
|----------|--------|----------|------|------|
| 1. コードセキュリティ | App Engineer Lead | セクション1,2,4完了 | | |
| 2. インフラセキュリティ | Network Engineer | セクション3,5,6,7完了 | | |
| 3. セキュリティテスト | White Hacker | セクション8完了 | | |
| 4. コンプライアンス | CLO | セクション9完了 | | |
| 5. 最終承認 | CISO | 全セクション完了 | | |
| 6. デプロイ承認 | CTO | CISO承認後 | | |

### 12.2 承認プロセス

1. 各セクションの担当者がチェック項目を確認
2. セクション完了後、該当する承認者が署名
3. 全セクション完了後、CISOが最終承認
4. CTOがデプロイ承認
5. DevOpsがデプロイ実行

### 12.3 例外承認

中程度以下の脆弱性を例外的に許容する場合:

| 脆弱性ID | 説明 | リスク評価 | 緩和策 | 承認者 | 期限 |
|----------|------|-----------|--------|--------|------|
| | | | | | |

---

## 13. デプロイ後アクション

### 13.1 即時実行

| # | アクション | 担当者 | 完了 |
|---|------------|--------|------|
| 13.1.1 | スモークテスト実行 | DevOps | ☐ |
| 13.1.2 | セキュリティヘッダー確認 | SOC Analyst | ☐ |
| 13.1.3 | SSL/TLS設定確認 | Network Engineer | ☐ |
| 13.1.4 | 監視ダッシュボード確認 | SOC Analyst | ☐ |
| 13.1.5 | ログ収集確認 | SOC Analyst | ☐ |

### 13.2 24時間以内

| # | アクション | 担当者 | 完了 |
|---|------------|--------|------|
| 13.2.1 | 本番脆弱性スキャン | White Hacker | ☐ |
| 13.2.2 | パフォーマンス監視確認 | DevOps | ☐ |
| 13.2.3 | エラー率監視確認 | SOC Analyst | ☐ |

---

## 14. ロールバック手順

デプロイ後に重大な問題が発見された場合:

1. **即時判断** (CISO/CTO)
   - セキュリティインシデントの場合: 即時ロールバック
   - 機能障害の場合: 影響範囲を評価後判断

2. **ロールバック実行** (DevOps)
   ```bash
   # Kubernetesの場合
   kubectl rollout undo deployment/lifeplan-navigator

   # その他の場合
   [デプロイツール固有のロールバックコマンド]
   ```

3. **通知** (CSIRT Leader)
   - 関係者への即時通知
   - インシデント記録

4. **原因分析** (App Engineer + White Hacker)
   - 根本原因分析
   - 再発防止策策定

---

## 連絡先

| 役職 | 連絡コマンド |
|------|-------------|
| CISO | `./agent-send.sh ciso "[メッセージ]"` |
| CSIRT Leader | `./agent-send.sh csirt_leader "[メッセージ]"` |
| White Hacker | `./agent-send.sh white_hacker "[メッセージ]"` |
| Network Engineer | `./agent-send.sh network_eng "[メッセージ]"` |
| SOC Analyst | `./agent-send.sh soc "[メッセージ]"` |

---

**ドキュメント管理**

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| 1.0 | 2025-12-11 | 初版作成 | CISO |

---
*本ドキュメントは機密情報を含みます。取り扱いには十分ご注意ください。*
