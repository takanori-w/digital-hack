# LifePlan Navigator SOC監視設計書

| 項目 | 内容 |
|------|------|
| ドキュメント名 | SOC監視設計書 |
| バージョン | 1.0 |
| 作成日 | 2025-12-11 |
| 作成者 | SOC Analyst |
| レビュー | CSIRT Team Leader, CTI Analyst, Network Engineer |
| 分類 | Confidential |

---

## 1. 概要

### 1.1 目的
本ドキュメントは、LifePlan Navigator における24時間365日のセキュリティ監視体制を定義する。個人のライフプラン情報という機密性の高いデータを扱うため、適切な監視・検知・対応体制を構築する。

### 1.2 適用範囲
- LifePlan Navigator Webアプリケーション
- 関連するインフラストラクチャ（クラウド/オンプレミス）
- ネットワーク機器・セキュリティ機器
- 外部連携サービス

### 1.3 準拠規格
- NIST CSF 2.0 (Detect機能)
- ISO 27001:2022 (A.12 運用のセキュリティ)
- GDPR Article 32 (セキュリティ措置)
- 個人情報保護法

---

## 2. 監視対象の定義

### 2.1 監視対象マトリクス

| 層 | 対象 | 監視項目 | 優先度 |
|----|------|----------|--------|
| **アプリケーション層** | Webアプリ | レスポンスタイム、エラー率、アクセスログ | P1 |
| | API Gateway | リクエスト数、レイテンシー、エラーレート | P1 |
| | 認証サービス | ログイン試行、認証失敗、セッション管理 | P0 |
| | バックエンドサービス | 処理時間、例外発生、リソース使用率 | P1 |
| **データ層** | PostgreSQL | クエリ性能、接続数、レプリケーション遅延 | P1 |
| | Redis | メモリ使用率、ヒット率、接続数 | P2 |
| | ファイルストレージ | ディスク使用率、I/O性能、アクセスログ | P2 |
| **インフラ層** | コンテナ/VM | CPU、メモリ、ディスク、ネットワーク | P1 |
| | Kubernetes | Pod状態、ノード状態、リソースクォータ | P1 |
| | ロードバランサー | 接続数、レスポンス分布、ヘルスチェック | P1 |
| **ネットワーク層** | ファイアウォール | 許可/拒否ログ、接続状態、ルール適用 | P0 |
| | WAF | ブロック数、攻撃パターン、誤検知率 | P0 |
| | IDS/IPS | シグネチャ検知、異常検知、アラート | P0 |
| | VPN | 接続状態、認証ログ、トラフィック量 | P1 |
| **セキュリティ層** | SIEM | 相関分析、アラート、レポート | P0 |
| | EDR | エンドポイント状態、脅威検知、隔離状態 | P1 |
| | 脆弱性スキャナ | スキャン結果、新規脆弱性、修正状況 | P2 |

### 2.2 監視対象システム構成図

```
                                    【監視対象システム構成】
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Internet                                        │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                              ┌───────▼───────┐
                              │    CDN/WAF    │ ← 監視ポイント A
                              │  (Cloudflare) │
                              └───────┬───────┘
                                      │
                              ┌───────▼───────┐
                              │ Load Balancer │ ← 監視ポイント B
                              │    (ALB)      │
                              └───────┬───────┘
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
┌───────▼───────┐             ┌───────▼───────┐             ┌───────▼───────┐
│   Web Server  │             │  API Gateway  │             │   Auth Server │
│   (Frontend)  │             │    (Kong)     │             │   (Keycloak)  │
└───────┬───────┘             └───────┬───────┘             └───────┬───────┘
        │                             │                             │
        └─────────────────────────────┼─────────────────────────────┘
                                      │ ← 監視ポイント C (アプリケーション層)
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
┌───────▼───────┐             ┌───────▼───────┐             ┌───────▼───────┐
│ Backend API   │             │ Batch Service │             │ Notification  │
│   Service     │             │               │             │   Service     │
└───────┬───────┘             └───────┬───────┘             └───────┬───────┘
        │                             │                             │
        └─────────────────────────────┼─────────────────────────────┘
                                      │ ← 監視ポイント D (データ層)
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
┌───────▼───────┐             ┌───────▼───────┐             ┌───────▼───────┐
│  PostgreSQL   │             │    Redis      │             │  Object Store │
│   (Primary)   │             │   (Cluster)   │             │    (S3)       │
└───────────────┘             └───────────────┘             └───────────────┘
```

---

## 3. 監視メトリクス設計

### 3.1 アプリケーションメトリクス

#### 3.1.1 パフォーマンスメトリクス

| メトリクス名 | 説明 | 収集間隔 | 保持期間 |
|-------------|------|----------|----------|
| `app.response_time.p50` | レスポンスタイム 50パーセンタイル | 10秒 | 30日 |
| `app.response_time.p95` | レスポンスタイム 95パーセンタイル | 10秒 | 30日 |
| `app.response_time.p99` | レスポンスタイム 99パーセンタイル | 10秒 | 30日 |
| `app.request_rate` | リクエスト数/秒 | 10秒 | 30日 |
| `app.error_rate` | エラー率 (%) | 10秒 | 90日 |
| `app.availability` | 可用性 (%) | 1分 | 365日 |

#### 3.1.2 セキュリティメトリクス

| メトリクス名 | 説明 | 収集間隔 | 保持期間 |
|-------------|------|----------|----------|
| `sec.auth.login_attempts` | ログイン試行数 | リアルタイム | 365日 |
| `sec.auth.login_failures` | ログイン失敗数 | リアルタイム | 365日 |
| `sec.auth.account_lockouts` | アカウントロック数 | リアルタイム | 365日 |
| `sec.session.active_count` | アクティブセッション数 | 1分 | 90日 |
| `sec.session.anomaly_score` | セッション異常スコア | リアルタイム | 365日 |
| `sec.api.rate_limit_hits` | レート制限ヒット数 | 1分 | 90日 |
| `sec.data.access_count` | データアクセス数 | リアルタイム | 365日 |
| `sec.data.export_count` | データエクスポート数 | リアルタイム | 365日 |

### 3.2 インフラストラクチャメトリクス

#### 3.2.1 コンピュートリソース

| メトリクス名 | 説明 | 収集間隔 | 保持期間 |
|-------------|------|----------|----------|
| `infra.cpu.utilization` | CPU使用率 (%) | 10秒 | 30日 |
| `infra.memory.utilization` | メモリ使用率 (%) | 10秒 | 30日 |
| `infra.disk.utilization` | ディスク使用率 (%) | 1分 | 30日 |
| `infra.disk.iops` | ディスクIOPS | 10秒 | 7日 |
| `infra.network.in_bytes` | 受信バイト数/秒 | 10秒 | 7日 |
| `infra.network.out_bytes` | 送信バイト数/秒 | 10秒 | 7日 |

#### 3.2.2 Kubernetesメトリクス

| メトリクス名 | 説明 | 収集間隔 | 保持期間 |
|-------------|------|----------|----------|
| `k8s.pod.status` | Pod状態 | 15秒 | 30日 |
| `k8s.pod.restart_count` | Pod再起動数 | 1分 | 90日 |
| `k8s.node.condition` | ノード状態 | 30秒 | 30日 |
| `k8s.deployment.replicas` | レプリカ数 | 30秒 | 30日 |
| `k8s.hpa.current_replicas` | HPA現在レプリカ数 | 30秒 | 30日 |

### 3.3 データベースメトリクス

| メトリクス名 | 説明 | 収集間隔 | 保持期間 |
|-------------|------|----------|----------|
| `db.connections.active` | アクティブ接続数 | 10秒 | 30日 |
| `db.connections.waiting` | 待機接続数 | 10秒 | 30日 |
| `db.query.duration_avg` | 平均クエリ実行時間 | 10秒 | 30日 |
| `db.query.slow_count` | スロークエリ数 | 1分 | 90日 |
| `db.replication.lag` | レプリケーション遅延(秒) | 10秒 | 30日 |
| `db.deadlock.count` | デッドロック数 | 1分 | 90日 |

### 3.4 ネットワーク・セキュリティメトリクス

| メトリクス名 | 説明 | 収集間隔 | 保持期間 |
|-------------|------|----------|----------|
| `net.firewall.blocked_count` | FWブロック数 | 1分 | 90日 |
| `net.waf.attack_blocked` | WAF攻撃ブロック数 | リアルタイム | 365日 |
| `net.ids.alert_count` | IDS/IPSアラート数 | リアルタイム | 365日 |
| `net.ddos.traffic_anomaly` | DDoS異常スコア | 10秒 | 90日 |
| `net.ssl.cert_expiry_days` | SSL証明書残日数 | 1日 | 90日 |

---

## 4. アラート閾値設定

### 4.1 アラート重要度定義

| 重要度 | 説明 | 対応時間 | エスカレーション |
|--------|------|----------|------------------|
| **Critical (P0)** | サービス停止、データ漏洩の可能性 | 即時 | CSIRT Leader → CISO → CEO |
| **High (P1)** | サービス劣化、セキュリティ侵害の兆候 | 15分以内 | CSIRT Leader → CISO |
| **Medium (P2)** | パフォーマンス低下、要注意事象 | 4時間以内 | CSIRT Leader |
| **Low (P3)** | 軽微な異常、情報提供 | 24時間以内 | SOC内で対応 |
| **Info** | 参考情報 | 定期レビュー | なし |

### 4.2 アプリケーションアラート閾値

| アラート名 | メトリクス | 条件 | 重要度 | 持続時間 |
|-----------|-----------|------|--------|----------|
| APP-001 | `app.availability` | < 99.9% | Critical | 5分 |
| APP-002 | `app.error_rate` | > 5% | High | 5分 |
| APP-003 | `app.error_rate` | > 1% | Medium | 10分 |
| APP-004 | `app.response_time.p95` | > 3秒 | High | 5分 |
| APP-005 | `app.response_time.p95` | > 1秒 | Medium | 10分 |
| APP-006 | `app.request_rate` | 急増 (2倍以上) | High | 1分 |

### 4.3 セキュリティアラート閾値

| アラート名 | メトリクス | 条件 | 重要度 | 持続時間 |
|-----------|-----------|------|--------|----------|
| SEC-001 | `sec.auth.login_failures` | 同一IP 5回/5分 | High | 即時 |
| SEC-002 | `sec.auth.login_failures` | 同一アカウント 3回/5分 | Medium | 即時 |
| SEC-003 | `sec.auth.account_lockouts` | > 10件/時 | High | 即時 |
| SEC-004 | `sec.session.anomaly_score` | > 0.8 | Critical | 即時 |
| SEC-005 | `sec.api.rate_limit_hits` | > 100回/分 | High | 即時 |
| SEC-006 | `sec.data.export_count` | > 1000件/時 (同一ユーザー) | Critical | 即時 |
| SEC-007 | `sec.data.access_count` | 通常の3倍以上 | High | 5分 |

### 4.4 インフラストラクチャアラート閾値

| アラート名 | メトリクス | 条件 | 重要度 | 持続時間 |
|-----------|-----------|------|--------|----------|
| INFRA-001 | `infra.cpu.utilization` | > 90% | High | 5分 |
| INFRA-002 | `infra.cpu.utilization` | > 80% | Medium | 15分 |
| INFRA-003 | `infra.memory.utilization` | > 90% | High | 5分 |
| INFRA-004 | `infra.memory.utilization` | > 85% | Medium | 15分 |
| INFRA-005 | `infra.disk.utilization` | > 90% | Critical | 即時 |
| INFRA-006 | `infra.disk.utilization` | > 80% | High | 即時 |
| INFRA-007 | `k8s.pod.restart_count` | > 3回/時 | High | 即時 |
| INFRA-008 | `k8s.node.condition` | NotReady | Critical | 1分 |

### 4.5 ネットワーク・セキュリティアラート閾値

| アラート名 | メトリクス | 条件 | 重要度 | 持続時間 |
|-----------|-----------|------|--------|----------|
| NET-001 | `net.waf.attack_blocked` | SQLi検知 | Critical | 即時 |
| NET-002 | `net.waf.attack_blocked` | XSS検知 | High | 即時 |
| NET-003 | `net.ids.alert_count` | シグネチャ一致 | High | 即時 |
| NET-004 | `net.ddos.traffic_anomaly` | > 0.9 | Critical | 30秒 |
| NET-005 | `net.firewall.blocked_count` | > 1000回/分 (同一IP) | High | 即時 |
| NET-006 | `net.ssl.cert_expiry_days` | < 30日 | Medium | 即時 |
| NET-007 | `net.ssl.cert_expiry_days` | < 7日 | Critical | 即時 |

### 4.6 データベースアラート閾値

| アラート名 | メトリクス | 条件 | 重要度 | 持続時間 |
|-----------|-----------|------|--------|----------|
| DB-001 | `db.connections.active` | > 最大の90% | Critical | 1分 |
| DB-002 | `db.connections.waiting` | > 10 | High | 5分 |
| DB-003 | `db.query.slow_count` | > 50件/分 | High | 5分 |
| DB-004 | `db.replication.lag` | > 30秒 | Critical | 1分 |
| DB-005 | `db.replication.lag` | > 5秒 | High | 5分 |
| DB-006 | `db.deadlock.count` | > 0 | High | 即時 |

---

## 5. 監視ツールスタック

### 5.1 監視基盤構成

```
┌──────────────────────────────────────────────────────────────────────┐
│                         監視基盤アーキテクチャ                         │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                    可視化・アラート層                         │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │    │
│  │  │   Grafana    │  │  PagerDuty   │  │    Slack     │       │    │
│  │  │ (Dashboard)  │  │  (On-Call)   │  │  (通知)      │       │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘       │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                              ↑                                       │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                      分析・相関層                             │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │    │
│  │  │  Splunk ES   │  │  Elastic     │  │  Amazon      │       │    │
│  │  │    (SIEM)    │  │  Security    │  │  GuardDuty   │       │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘       │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                              ↑                                       │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                      収集・保存層                             │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │    │
│  │  │ Prometheus   │  │   Fluentd    │  │  CloudWatch  │       │    │
│  │  │  (Metrics)   │  │   (Logs)     │  │   (AWS)      │       │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘       │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                              ↑                                       │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                      エージェント層                           │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │    │
│  │  │ Prometheus   │  │   Fluent     │  │   AWS        │       │    │
│  │  │  Exporter    │  │    Bit       │  │   Agent      │       │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘       │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 5.2 ツール役割定義

| カテゴリ | ツール | 役割 |
|---------|--------|------|
| **メトリクス収集** | Prometheus | アプリ/インフラメトリクス収集・保存 |
| | CloudWatch | AWSリソースメトリクス |
| **ログ収集** | Fluent Bit/Fluentd | ログ収集・転送 |
| | CloudWatch Logs | AWSログ集約 |
| **SIEM** | Splunk Enterprise Security | ログ分析・相関分析・インシデント管理 |
| | Elastic Security | 補助SIEM・脅威ハンティング |
| **可視化** | Grafana | ダッシュボード・メトリクス可視化 |
| **アラート管理** | PagerDuty | オンコール管理・エスカレーション |
| | Slack | リアルタイム通知 |
| **脅威検知** | Amazon GuardDuty | AWS脅威検知 |
| | AWS Security Hub | セキュリティ統合管理 |

---

## 6. 監視ダッシュボード設計

### 6.1 ダッシュボード一覧

| ダッシュボード名 | 目的 | 対象者 | 更新頻度 |
|-----------------|------|--------|----------|
| SOC Overview | セキュリティ状況全体把握 | SOC Analyst | 10秒 |
| Security Incidents | インシデント一覧・状態 | CSIRT | リアルタイム |
| Authentication Monitor | 認証状況監視 | SOC Analyst | リアルタイム |
| Network Security | ネットワークセキュリティ状況 | Network Engineer | 10秒 |
| Application Performance | アプリパフォーマンス | App Engineer | 10秒 |
| Infrastructure Health | インフラ状態 | SRE | 30秒 |
| Executive Summary | 経営層向けサマリー | CISO/CEO | 1時間 |

### 6.2 SOC Overview ダッシュボード構成

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    SOC Overview Dashboard                                │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐            │
│ │ Active Alerts   │ │ Security Score  │ │ Threat Level   │            │
│ │     [12]        │ │    [87/100]     │ │    [MEDIUM]    │            │
│ │ Critical: 2     │ │                 │ │                │            │
│ │ High: 4         │ │   ████████░░    │ │    ████░░░░    │            │
│ │ Medium: 6       │ │                 │ │                │            │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘            │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────┐ ┌──────────────────────────────┐  │
│ │ Authentication Activity         │ │ WAF/IDS Events               │  │
│ │                                 │ │                              │  │
│ │ Login Success: ███████████ 1.2K│ │ Blocked Attacks: ███████ 847│  │
│ │ Login Failed:  ██ 45           │ │ SQL Injection:   ██ 23       │  │
│ │ Account Locked: █ 3            │ │ XSS Attempts:    ███ 31      │  │
│ └──────────────────────────────────┘ └──────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────────────────────────┐   │
│ │ Security Event Timeline (24h)                                    │   │
│ │                                                                  │   │
│ │     ▲                                                           │   │
│ │     │    ╭──╮                      ╭─╮                          │   │
│ │     │   ╭╯  ╰╮    ╭──╮           ╭╯ ╰╮                          │   │
│ │     │ ──╯    ╰────╯  ╰───────────╯   ╰──                        │   │
│ │     └───────────────────────────────────────► Time              │   │
│ │        00:00    06:00    12:00    18:00    24:00                 │   │
│ └──────────────────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────────────────────────┐   │
│ │ Recent Security Alerts                                           │   │
│ │                                                                  │   │
│ │ [CRITICAL] 10:23 SEC-004 Session anomaly detected - User: admin  │   │
│ │ [HIGH]     10:15 SEC-001 Brute force attempt - IP: 203.x.x.x     │   │
│ │ [HIGH]     09:58 NET-002 XSS attack blocked - Path: /api/search  │   │
│ │ [MEDIUM]   09:45 SEC-003 Account lockout spike detected          │   │
│ └──────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 監視運用体制

### 7.1 シフト体制

| シフト | 時間帯 | 担当人数 | 役割 |
|--------|--------|----------|------|
| Day Shift | 09:00-17:00 | 3名 | メイン監視、調査、対応 |
| Evening Shift | 17:00-01:00 | 2名 | 監視継続、一次対応 |
| Night Shift | 01:00-09:00 | 2名 | 監視継続、緊急エスカ |
| On-Call | 24/7 | 1名 | エスカレーション対応 |

### 7.2 ローテーションスケジュール

```
Week 1:  Team A (Day) → Team B (Evening) → Team C (Night)
Week 2:  Team B (Day) → Team C (Evening) → Team A (Night)
Week 3:  Team C (Day) → Team A (Evening) → Team B (Night)
```

### 7.3 連絡体制

```
┌─────────────────────────────────────────────────────────────────┐
│                      SOC 連絡体制図                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐                                                │
│  │ SOC Analyst │ ← 一次検知・分析                               │
│  └──────┬──────┘                                                │
│         │ P2以上                                                │
│         ▼                                                       │
│  ┌─────────────────┐                                            │
│  │ CSIRT Team Lead │ ← インシデント判断・対応指揮               │
│  └────────┬────────┘                                            │
│           │ P1以上                                              │
│    ┌──────┼──────────────────┐                                  │
│    │      │                  │                                  │
│    ▼      ▼                  ▼                                  │
│ ┌──────┐ ┌────────────┐ ┌──────────┐                           │
│ │ CISO │ │ CTI Analyst│ │ Engineers│ ← 専門分析・技術対応      │
│ └──┬───┘ └────────────┘ └──────────┘                           │
│    │ P0                                                         │
│    ▼                                                            │
│ ┌─────────────────────────────────────┐                         │
│ │ Executive (CEO, CLO, CFO, CMO)      │ ← 経営判断・外部対応    │
│ └─────────────────────────────────────┘                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 8. 関連ドキュメント

| ドキュメント | 説明 |
|-------------|------|
| LifePlan_Navigator_Log_Management.md | ログ管理設計書 |
| LifePlan_Navigator_Detection_Rules.md | 検知ルール一覧 |
| LifePlan_Navigator_Alert_Rules.md | アラートルール一覧 |
| LifePlan_Navigator_SOC_Runbook.md | SOC運用手順書 |

---

## 9. 改訂履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| 1.0 | 2025-12-11 | 初版作成 | SOC Analyst |

---

## 10. 承認

| 役割 | 氏名 | 日付 | 署名 |
|------|------|------|------|
| 作成者 | SOC Analyst | 2025-12-11 | |
| レビュー | CSIRT Team Leader | | |
| レビュー | CTI Analyst | | |
| レビュー | Network Engineer | | |
| 承認 | CISO | | |
