# LifePlan Navigator 調査チェックリスト

**Version**: 1.0
**Last Updated**: 2025-12-11
**Document Owner**: CSIRT Engineer
**Classification**: Internal Use Only

---

## 1. 概要

本文書は、LifePlan Navigator（個人ライフプラン支援Webアプリ）のセキュリティインシデント調査時に使用するチェックリストを提供する。調査の抜け漏れを防ぎ、体系的な調査を実施するためのガイドラインである。

---

## 2. 初動調査チェックリスト

### 2.1 アラート受領時（最初の15分）

```markdown
## 初動調査チェックリスト

**Incident ID**: INC-______________
**調査開始日時**: ____-__-__ __:__
**調査担当者**: ________________

### アラート情報の確認
- [ ] アラートソースの特定（SIEM/EDR/IDS/ユーザー報告）
- [ ] アラート発生日時の記録
- [ ] アラートの重要度（Severity）の確認
- [ ] 関連するログ/イベントの初期確認

### 影響範囲の初期評価
- [ ] 対象システム/ホストの特定
- [ ] 対象IPアドレス/ホスト名の記録
- [ ] 影響を受ける可能性のあるサービスの特定
- [ ] 他システムへの波及可能性の評価

### 初期トリアージ判断
- [ ] True Positive / False Positive の判定
- [ ] インシデント種別の暫定分類
- [ ] 優先度（P0/P1/P2/P3）の判定
- [ ] エスカレーション要否の判断

### 連絡・報告
- [ ] CSIRT Team Leader への初報
- [ ] 必要に応じて関係者への連絡
- [ ] インシデントチケットの起票
```

### 2.2 証拠保全（最初の1時間）

```markdown
## 証拠保全チェックリスト

### 揮発性データの収集
- [ ] システムメモリのダンプ取得
  - ツール使用: LiME / WinPMEM / DumpIt
  - 取得時刻: ____-__-__ __:__
  - ファイルサイズ: ________ bytes
  - SHA256: ________________________________

- [ ] 実行中プロセス一覧の記録
  - Linux: `ps auxf > processes.txt`
  - Windows: `Get-Process > processes.txt`

- [ ] ネットワーク接続情報の記録
  - Linux: `netstat -tulpn > netstat.txt`
  - Windows: `netstat -ano > netstat.txt`

- [ ] ARPテーブルの記録
  - `arp -a > arp_table.txt`

- [ ] ルーティングテーブルの記録
  - `ip route > routing.txt` / `route print > routing.txt`

### 非揮発性データの収集
- [ ] ディスクイメージの取得
  - 方法: dd / ewfacquire / FTK Imager
  - 取得時刻: ____-__-__ __:__
  - イメージサイズ: ________ bytes
  - SHA256: ________________________________

- [ ] ログファイルのコピー
  - アプリケーションログ: /var/log/lifeplan-navigator/
  - Webサーバーログ: /var/log/nginx/
  - システムログ: /var/log/syslog, /var/log/auth.log
  - データベースログ: PostgreSQL監査ログ

### クラウド証拠の収集（AWS）
- [ ] CloudTrailログのエクスポート
- [ ] VPC Flow Logsのエクスポート
- [ ] RDS監査ログのエクスポート
- [ ] S3アクセスログのエクスポート
- [ ] EC2スナップショットの作成

### Chain of Custody
- [ ] Evidence IDの採番
- [ ] 証拠保管連鎖フォームの作成
- [ ] ハッシュ値の記録と検証
- [ ] 証拠の安全な保管場所への移動
```

---

## 3. シナリオ別調査チェックリスト

### 3.1 マルウェア感染調査

```markdown
## マルウェア感染調査チェックリスト

**調査対象ホスト**: ________________
**検出マルウェア**: ________________
**調査開始日時**: ____-__-__ __:__

### Phase 1: 感染確認
- [ ] EDR/アンチウイルスのアラート確認
- [ ] 不審なプロセスの特定
- [ ] 不審なネットワーク接続の特定
- [ ] 不審なファイル/ディレクトリの特定
- [ ] スタートアップ項目の確認

### Phase 2: マルウェアサンプル収集
- [ ] マルウェア検体のコピー（隔離環境へ）
- [ ] 検体のハッシュ値計算
  - MD5: ________________________________
  - SHA256: ________________________________
- [ ] VirusTotal等での既知マルウェア確認

### Phase 3: 静的解析
- [ ] ファイルタイプの確認
- [ ] 文字列抽出・分析
- [ ] PE/ELFヘッダー解析
- [ ] インポート/エクスポート関数の確認
- [ ] パッカー/プロテクターの検出

### Phase 4: 動的解析
- [ ] サンドボックスでの実行
- [ ] ネットワーク通信の記録
- [ ] ファイルシステム変更の記録
- [ ] レジストリ変更の記録（Windows）
- [ ] 子プロセス生成の確認

### Phase 5: 侵入経路の特定
- [ ] メール添付ファイルの確認
- [ ] ダウンロード履歴の確認
- [ ] ブラウザ履歴の確認
- [ ] 外部メディアの接続履歴確認
- [ ] 他システムからの横展開の確認

### Phase 6: 横展開の確認
- [ ] 認証ログでの不審なログオンの確認
- [ ] ネットワークスキャンの痕跡確認
- [ ] 他ホストへの接続試行の確認
- [ ] 管理共有（C$, ADMIN$）へのアクセス確認
- [ ] Pass-the-Hash/Pass-the-Ticketの痕跡確認

### IoC（侵害指標）の抽出
- [ ] ファイルハッシュ
- [ ] C2サーバーIP/ドメイン
- [ ] 作成されたファイルパス
- [ ] レジストリキー（Windows）
- [ ] Mutex名
- [ ] User-Agent文字列
```

### 3.2 不正アクセス調査

```markdown
## 不正アクセス調査チェックリスト

**対象システム**: ________________
**検知日時**: ____-__-__ __:__
**調査担当者**: ________________

### Phase 1: アクセス経路の特定
- [ ] 認証ログの分析
  - 対象ログ: /var/log/auth.log, sshd, PAM
  - 不審なログオン試行の抽出
  - ブルートフォース攻撃の痕跡確認

- [ ] Webアクセスログの分析
  - 不審なリクエストパターンの特定
  - SQLインジェクション試行の確認
  - パストラバーサル試行の確認
  - 認証バイパス試行の確認

- [ ] VPN/リモートアクセスログの分析
  - 不審な接続元IPの確認
  - 通常と異なる接続時間帯の確認
  - 地理的に不審なアクセス元の確認

### Phase 2: 悪用されたアカウントの特定
- [ ] 不正使用されたアカウントの特定
- [ ] アカウントの権限レベルの確認
- [ ] パスワード変更履歴の確認
- [ ] MFA設定状況の確認
- [ ] アカウント作成日時の確認

### Phase 3: 攻撃者の行動分析
- [ ] コマンド履歴の分析
  - .bash_history
  - PowerShell履歴
- [ ] ファイルアクセス履歴の分析
- [ ] データベースクエリログの分析
- [ ] API呼び出しログの分析

### Phase 4: 権限昇格の確認
- [ ] sudo/su使用履歴の確認
- [ ] 権限昇格脆弱性の悪用痕跡
- [ ] 新規管理者アカウントの作成確認
- [ ] グループメンバーシップの変更確認

### Phase 5: 永続化の確認
- [ ] 新規ユーザーアカウントの作成確認
- [ ] SSH authorized_keys の変更確認
- [ ] cron/systemd タスクの確認
- [ ] バックドアファイルの検索
- [ ] WebShellの検索

### Phase 6: データアクセス/窃取の確認
- [ ] 機密ファイルへのアクセス履歴
- [ ] データベースへの大量クエリ
- [ ] データエクスポート操作の確認
- [ ] 外部へのデータ転送の確認
- [ ] 圧縮・暗号化ファイルの作成確認
```

### 3.3 データ漏洩調査

```markdown
## データ漏洩調査チェックリスト

**調査対象**: ________________
**漏洩検知日時**: ____-__-__ __:__
**調査担当者**: ________________

### Phase 1: 漏洩範囲の特定
- [ ] 漏洩したデータの種類の特定
  - [ ] 個人情報（PII）
  - [ ] 認証情報
  - [ ] 金融情報
  - [ ] 機密ビジネス情報
  - [ ] 医療情報（PHI）

- [ ] 漏洩したデータ量の推定
  - レコード数: ________
  - データサイズ: ________
  - 影響ユーザー数: ________

### Phase 2: 漏洩経路の特定
- [ ] 内部犯行の可能性
  - 内部者によるデータエクスポート
  - 印刷ログの確認
  - USBデバイス使用履歴

- [ ] 外部攻撃の可能性
  - SQLインジェクション
  - API脆弱性の悪用
  - 認証バイパス
  - マルウェアによる窃取

- [ ] 設定ミスによる漏洩
  - 公開設定のミス（S3バケット等）
  - 認証なしAPIエンドポイント
  - デバッグ情報の公開

### Phase 3: データベース調査
- [ ] 監査ログの分析
```sql
-- 大量データ取得クエリの特定
SELECT event_time, user_name, client_addr, statement, rows_returned
FROM pg_audit_log
WHERE rows_returned > 100
ORDER BY event_time DESC;
```

- [ ] アクセスパターンの異常検出
- [ ] データエクスポート操作の確認
- [ ] バックアップアクセスの確認

### Phase 4: ネットワーク調査
- [ ] 外部への大容量データ転送の確認
- [ ] 不審な宛先への通信確認
- [ ] DNSトンネリングの確認
- [ ] 暗号化通信の異常増加確認

### Phase 5: 漏洩先の特定
- [ ] ダークウェブモニタリング
- [ ] ペーストサイトの監視
- [ ] 外部報告/通報の確認
- [ ] メディア報道の確認

### Phase 6: 影響評価
- [ ] 規制上の報告義務の確認
  - [ ] GDPR（72時間以内）
  - [ ] CCPA
  - [ ] 個人情報保護法
- [ ] 顧客への通知要否の判断
- [ ] 法的リスクの評価
```

### 3.4 ランサムウェア調査

```markdown
## ランサムウェア調査チェックリスト

**感染検知日時**: ____-__-__ __:__
**影響システム数**: ________
**調査担当者**: ________________

### Phase 1: 感染範囲の特定
- [ ] 暗号化されたファイルの拡張子の確認
- [ ] ランサムノート（身代金要求文）の収集
- [ ] 感染ホスト一覧の作成
- [ ] 暗号化されたファイル数/サイズの推定
- [ ] ネットワーク共有への影響確認

### Phase 2: ランサムウェアの特定
- [ ] ランサムウェアファミリーの特定
  - 暗号化拡張子から特定
  - ランサムノートから特定
  - ID Ransomware等のサービス利用
- [ ] 復号ツールの有無確認
  - No More Ransom Project
  - ベンダー提供ツール

### Phase 3: 侵入経路の特定
- [ ] フィッシングメールの確認
- [ ] RDP/VPN経由のアクセス確認
- [ ] 脆弱性の悪用確認
- [ ] サプライチェーン攻撃の確認

### Phase 4: Patient Zero（最初の感染端末）の特定
- [ ] ファイル暗号化の最初の発生時刻
- [ ] 最初に不審プロセスが実行された端末
- [ ] 最初にC2通信が発生した端末
- [ ] 横展開の起点となった端末

### Phase 5: データ窃取の確認（二重恐喝対策）
- [ ] 暗号化前のデータ窃取の痕跡
- [ ] 外部への大容量データ転送の確認
- [ ] ステージングディレクトリの確認
- [ ] 圧縮ファイル作成の痕跡

### Phase 6: 復旧可能性の評価
- [ ] バックアップの感染状況確認
- [ ] クリーンなバックアップの特定
- [ ] 復号キーの入手可能性
- [ ] データ復元の優先順位付け

### 身代金対応判断
- [ ] 身代金額の確認
- [ ] 支払いに関する法的制約の確認（OFAC制裁リスト）
- [ ] 経営層への報告と判断仰ぎ
- [ ] ※身代金支払いは最終手段、原則非推奨
```

### 3.5 内部不正調査

```markdown
## 内部不正調査チェックリスト

**調査対象者**: ________________
**調査開始日時**: ____-__-__ __:__
**調査担当者**: ________________

### 調査前準備
- [ ] CLO（法務）への相談・承認取得
- [ ] 人事部門との連携
- [ ] 調査の法的正当性の確認
- [ ] プライバシーへの配慮確認
- [ ] 調査範囲の明確化

### Phase 1: ユーザー活動の分析
- [ ] ログオン/ログオフ履歴の分析
- [ ] 通常と異なるアクセス時間の確認
- [ ] アクセスしたシステム/ファイルの確認
- [ ] 権限外アクセスの試行確認

### Phase 2: データアクセスの分析
- [ ] 機密ファイルへのアクセス履歴
- [ ] データベースクエリの分析
- [ ] ファイルダウンロード履歴
- [ ] クラウドストレージへのアップロード確認

### Phase 3: 外部転送の確認
- [ ] メール送信履歴の分析（添付ファイル含む）
- [ ] クラウドストレージ利用の確認
- [ ] USBデバイス使用履歴
- [ ] 印刷履歴の確認
- [ ] スクリーンショット取得の痕跡

### Phase 4: 端末フォレンジック
- [ ] ブラウザ履歴の分析
- [ ] ローカルファイルの分析
- [ ] 削除されたファイルの復元
- [ ] 外部メディアの接続履歴

### Phase 5: 通信の分析
- [ ] ネットワーク通信ログの分析
- [ ] チャット/メッセージ履歴（業務用）
- [ ] 不審な外部サービスへの通信

### 証拠の取り扱い
- [ ] Chain of Custodyの厳格な維持
- [ ] 証拠の改ざん防止措置
- [ ] 調査記録の詳細な文書化
- [ ] 法的手続きに備えた証拠保全
```

---

## 4. LifePlan Navigator 固有調査項目

### 4.1 アプリケーション固有のログ確認

```markdown
## LifePlan Navigator 固有調査項目

### アプリケーションログ
- [ ] /var/log/lifeplan-navigator/app.log
  - 認証イベントの確認
  - API呼び出しの確認
  - エラーログの確認

- [ ] /var/log/lifeplan-navigator/access.log
  - アクセスパターンの分析
  - 不審なリクエストの特定

- [ ] /var/log/lifeplan-navigator/security.log
  - セキュリティイベントの確認
  - 認証失敗の確認

### データベース監査
- [ ] ユーザーテーブルへのアクセス
- [ ] life_plans テーブルへのアクセス
- [ ] financial_data テーブルへのアクセス
- [ ] 管理者操作の確認

### API監査
- [ ] /api/auth/* エンドポイントの確認
- [ ] /api/users/* エンドポイントの確認
- [ ] /api/plans/* エンドポイントの確認
- [ ] レート制限の発動状況

### 機密データ確認
- [ ] 個人情報の漏洩確認
  - 氏名
  - メールアドレス
  - 住所
  - 電話番号
- [ ] 金融情報の漏洩確認
  - 収入情報
  - 資産情報
  - ライフプランデータ
```

### 4.2 AWSリソース調査

```markdown
## AWS環境調査チェックリスト

### IAM
- [ ] 不審なユーザー/ロールの作成確認
- [ ] アクセスキーの不正作成確認
- [ ] ポリシー変更の確認
- [ ] MFA設定変更の確認

### EC2
- [ ] セキュリティグループ変更の確認
- [ ] 不審なインスタンス作成の確認
- [ ] スナップショット作成/共有の確認
- [ ] インスタンスメタデータへのアクセス確認

### RDS
- [ ] データベースパラメータ変更の確認
- [ ] 不審なスナップショット作成の確認
- [ ] セキュリティグループ変更の確認
- [ ] 監査ログの分析

### S3
- [ ] バケットポリシー変更の確認
- [ ] 公開設定の変更確認
- [ ] 大量ダウンロードの確認
- [ ] 暗号化設定の変更確認

### CloudTrail
- [ ] ログ無効化の試行確認
- [ ] ログ削除の確認
- [ ] 証跡設定の変更確認
```

---

## 5. 調査完了チェックリスト

```markdown
## 調査完了チェックリスト

### 調査結果の文書化
- [ ] 調査タイムラインの作成
- [ ] 発見事項のサマリー作成
- [ ] IoC一覧の作成
- [ ] 影響範囲の最終確定
- [ ] 根本原因の特定

### レポート作成
- [ ] フォレンジック調査レポートの作成
- [ ] マルウェア解析レポート（該当時）
- [ ] 経営層向けサマリーの作成
- [ ] 技術詳細レポートの作成

### 証拠の最終処理
- [ ] 全証拠のハッシュ値再検証
- [ ] Chain of Custodyの完成
- [ ] 証拠の長期保管場所への移動
- [ ] 証拠アクセスログの確定

### 知見の共有
- [ ] SOC Analystへの新規IoC共有
- [ ] 検知ルールの更新提案
- [ ] Post-Mortemへの技術的インプット
- [ ] ナレッジベースの更新

### クローズ処理
- [ ] CSIRT Team Leader への最終報告
- [ ] インシデントチケットのクローズ
- [ ] 調査ツール・環境のクリーンアップ
- [ ] 次回調査への教訓の記録
```

---

## 6. クイックリファレンス

### 6.1 重要コマンド集（Linux）

```bash
# プロセス一覧（詳細）
ps auxf

# ネットワーク接続
netstat -tulpn
ss -tulpn

# 最近変更されたファイル
find /opt/lifeplan-navigator -mtime -1 -type f

# 隠しファイルの検索
find / -name ".*" -type f 2>/dev/null

# 不審なcronジョブ
crontab -l
cat /etc/crontab
ls -la /etc/cron.*

# 認証ログ
tail -100 /var/log/auth.log
grep "Failed password" /var/log/auth.log

# 最近のログインユーザー
last -a
lastlog

# システムサービス一覧
systemctl list-units --type=service

# 開いているファイル
lsof -i

# ユーザーアカウント確認
cat /etc/passwd
cat /etc/shadow
getent group

# SSH authorized_keys
find /home -name "authorized_keys" -exec cat {} \;
```

### 6.2 重要コマンド集（AWS CLI）

```bash
# IAM - 最近のアクティビティ
aws iam generate-credential-report
aws iam get-credential-report --query 'Content' --output text | base64 -d

# CloudTrail - 最近のイベント
aws cloudtrail lookup-events --max-results 50

# EC2 - セキュリティグループの変更
aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=AuthorizeSecurityGroupIngress

# S3 - バケットポリシーの変更
aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=PutBucketPolicy

# RDS - スナップショット
aws rds describe-db-snapshots --db-instance-identifier lifeplan-db-prod
```

### 6.3 緊急連絡先

| 役割 | 連絡先 | 備考 |
|------|--------|------|
| CSIRT Team Leader | [内線/携帯] | インシデント統括 |
| Network Engineer | [内線/携帯] | ネットワーク封じ込め |
| SOC Analyst | [内線/携帯] | 監視・検知 |
| CISO | [内線/携帯] | エスカレーション先 |
| CLO | [内線/携帯] | 法的助言 |

---

## 7. 付録

### 7.1 関連文書

- LifePlan_Navigator_Forensic_Procedures.md（フォレンジック手順書）
- LifePlan_Navigator_Investigation_Capabilities.md（調査能力構築）
- LifePlan_Navigator_Recovery_Procedures.md（復旧手順書）

### 7.2 改訂履歴

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-12-11 | CSIRT Engineer | 初版作成 |

---

**Document Classification**: Internal Use Only
**Review Cycle**: Quarterly
**Next Review**: 2026-03-11
