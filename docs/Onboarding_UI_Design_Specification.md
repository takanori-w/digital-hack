# オンボーディングUI設計仕様書

**作成日**: 2025-12-14
**作成者**: Project Support Team (App Engineer連携)
**文書番号**: SPEC-2025-003
**分類**: UI/UX設計仕様

---

## 1. 概要

### 1.1 目的

LifePlan Navigatorアプリケーションの新規ユーザー向けオンボーディングフローを設計し、ユーザーのライフステージに応じた最適な情報提供を実現するための情報収集を行う。

### 1.2 設計原則

| 原則 | 説明 |
|------|------|
| **シンプルさ** | 4ステップ以内で完了する簡潔なフロー |
| **親しみやすさ** | 動物（Zoo）テーマによる心理的バリアの低減 |
| **プライバシー配慮** | 必須項目を最小限に抑え、任意項目を明示 |
| **即時価値提供** | 入力後すぐにパーソナライズされた情報を表示 |

---

## 2. オンボーディングフロー設計

### 2.1 全体フロー

```
┌─────────────────────────────────────────────────────────────────┐
│                    Welcome Screen                                │
│  「あなたにぴったりの制度・給付金を見つけましょう」              │
│  🦁 ライフプランナビゲーターへようこそ                          │
│                    [はじめる]                                    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Step 1: 基本情報 (🦊 キツネ - 知恵の案内人)                    │
│  ─────────────────────────────────────────────────────────────  │
│  ● 年齢: [ドロップダウン / スライダー]                          │
│  ● 働き方: [選択肢]                                              │
│                                                                  │
│  Progress: ████░░░░░░░░ 25%                                      │
│                    [次へ →]                                      │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Step 2: 住まい情報 (🦫 ビーバー - 家づくりの達人)              │
│  ─────────────────────────────────────────────────────────────  │
│  ● 住まい状況: [選択肢]                                          │
│  ● 居住地域: [都道府県選択] (任意)                               │
│                                                                  │
│  Progress: ████████░░░░ 50%                                      │
│             [← 戻る]    [次へ →]                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Step 3: 家族構成 (🦘 カンガルー - 家族の守り手)                │
│  ─────────────────────────────────────────────────────────────  │
│  ● 世帯構成: [選択肢]                                            │
│  ● 配偶者: [有/無]                                               │
│  ● お子様: [有/無] → [人数・年齢入力]                           │
│                                                                  │
│  Progress: ████████████░ 75%                                     │
│             [← 戻る]    [次へ →]                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  Step 4: 今後の予定 & 通知設定 (🐝 ミツバチ - 未来への準備)     │
│  ─────────────────────────────────────────────────────────────  │
│  ● 今後の予定: [複数選択可]                                      │
│  ● メールアドレス: [入力欄] (通知希望時)                        │
│                                                                  │
│  Progress: ████████████████ 100%                                 │
│             [← 戻る]    [完了 ✓]                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Complete Screen                               │
│  🎉 設定が完了しました！                                        │
│                                                                  │
│  あなたにおすすめの情報が見つかりました:                        │
│  ┌─────────────────────────────────────────────────────┐        │
│  │ 🦉 住宅ローン控除について                          │        │
│  │ 🐢 国民年金の免除制度                              │        │
│  │ 🦘 児童手当の申請方法                              │        │
│  └─────────────────────────────────────────────────────┘        │
│                    [ホームへ]                                    │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 入力項目詳細

### 3.1 Step 1: 基本情報

#### 年齢
| 項目 | 仕様 |
|------|------|
| 入力形式 | ドロップダウン または スライダー |
| 範囲 | 18歳 〜 100歳 |
| 必須/任意 | **必須** |
| バリデーション | 数値、範囲チェック |

#### 働き方
| 項目 | 仕様 |
|------|------|
| 入力形式 | 単一選択（ラジオボタン/カード選択） |
| 選択肢 | 下記参照 |
| 必須/任意 | **必須** |

```typescript
enum EmploymentType {
  FULL_TIME_EMPLOYEE = "会社員（正社員）",
  CONTRACT_EMPLOYEE = "会社員（契約・派遣）",
  CIVIL_SERVANT = "公務員",
  SELF_EMPLOYED = "自営業・フリーランス",
  PART_TIME = "パート・アルバイト",
  STUDENT = "学生",
  HOMEMAKER = "専業主婦・主夫",
  RETIRED = "年金受給者・退職者",
  UNEMPLOYED = "求職中",
  OTHER = "その他"
}
```

### 3.2 Step 2: 住まい情報

#### 住まい状況
| 項目 | 仕様 |
|------|------|
| 入力形式 | 単一選択（アイコン付きカード） |
| 選択肢 | 下記参照 |
| 必須/任意 | **必須** |

```typescript
enum ResidenceType {
  RENTAL = "賃貸",
  OWNED = "持ち家",
  PARENTS_HOME = "実家",
  COMPANY_HOUSING = "社宅・寮",
  PUBLIC_HOUSING = "公営住宅",
  OTHER = "その他"
}
```

#### 居住地域
| 項目 | 仕様 |
|------|------|
| 入力形式 | ドロップダウン（都道府県） |
| 選択肢 | 47都道府県 + 「海外」 |
| 必須/任意 | **任意**（地域別制度検索に使用） |

### 3.3 Step 3: 家族構成

#### 世帯構成
| 項目 | 仕様 |
|------|------|
| 入力形式 | 単一選択 |
| 選択肢 | 下記参照 |
| 必須/任意 | **必須** |

```typescript
enum HouseholdType {
  SINGLE = "一人暮らし",
  COUPLE = "夫婦のみ",
  FAMILY_WITH_CHILDREN = "子供あり世帯",
  SINGLE_PARENT = "ひとり親世帯",
  THREE_GENERATION = "三世代同居",
  OTHER = "その他"
}
```

#### 配偶者
| 項目 | 仕様 |
|------|------|
| 入力形式 | Yes/No トグル |
| 条件分岐 | 「一人暮らし」選択時は非表示 |
| 必須/任意 | 条件付き必須 |

#### 子供情報
| 項目 | 仕様 |
|------|------|
| 入力形式 | 動的フォーム（追加/削除可能） |
| 子項目 | 年齢（0〜25歳）、同居/別居 |
| 必須/任意 | **任意**（ただし子育て関連制度の検索に影響） |

```typescript
interface Child {
  age: number;        // 0-25
  isCohabiting: boolean;
}
```

### 3.4 Step 4: 今後の予定 & 通知設定

#### 今後の予定
| 項目 | 仕様 |
|------|------|
| 入力形式 | 複数選択（チェックボックス/チップ） |
| 選択肢 | 下記参照 |
| 必須/任意 | **任意** |

```typescript
enum PlannedEvent {
  SIDE_BUSINESS = "副業の開始",
  JOB_CHANGE = "転職",
  RETIREMENT = "退職・定年",
  HOME_PURCHASE = "住宅購入",
  HOME_RENOVATION = "リフォーム",
  MARRIAGE = "結婚",
  CHILDBIRTH = "出産",
  CHILD_EDUCATION = "子供の進学",
  INHERITANCE = "相続",
  NURSING_CARE = "介護",
  RELOCATION = "引っ越し",
  NONE = "特になし"
}
```

#### メールアドレス
| 項目 | 仕様 |
|------|------|
| 入力形式 | テキスト入力（email type） |
| バリデーション | RFC 5322 準拠 |
| 必須/任意 | **任意**（通知希望時は必須） |
| 説明文 | 「法令変更やおすすめ情報をお届けします」 |

---

## 4. 動物テーマ（Zoo Theme）マッピング

### 4.1 オンボーディング時の動物ガイド

| Step | 動物 | 役割 | 理由 |
|------|------|------|------|
| Welcome | 🦁 ライオン | 歓迎・リーダー | 信頼感、頼りがいのある印象 |
| Step 1 | 🦊 キツネ | 基本情報の案内人 | 賢さ、的確な質問 |
| Step 2 | 🦫 ビーバー | 住まいの達人 | 家づくり、巣作りの象徴 |
| Step 3 | 🦘 カンガルー | 家族の守り手 | 子育て、家族の象徴 |
| Step 4 | 🐝 ミツバチ | 未来への準備 | 勤勉さ、計画性 |
| Complete | 🎉 パーティー | 完了のお祝い | 達成感の演出 |

### 4.2 情報カテゴリ別アイコン

| カテゴリ | 動物 | 象徴 |
|----------|------|------|
| 税金・控除 | 🦉 フクロウ | 知恵、複雑な税制をナビゲート |
| 社会保険 | 🐢 カメ | 堅実さ、長期的な保障 |
| 子育て支援 | 🦘 カンガルー | 子育ての象徴 |
| 住宅関連 | 🦫 ビーバー | 建築・家づくり |
| 就労・転職 | 🐝 ミツバチ | 勤勉さ、働くこと |
| 年金・老後 | 🐘 ゾウ | 長寿、長期記憶 |
| 相続・贈与 | 🦅 ワシ | 継承、高い視点 |

---

## 5. UIコンポーネント設計

### 5.1 共通コンポーネント

#### ProgressBar

```tsx
interface ProgressBarProps {
  currentStep: number;  // 1-4
  totalSteps: number;   // 4
}

// 表示例: ████████░░░░ 50%
```

#### StepHeader

```tsx
interface StepHeaderProps {
  step: number;
  title: string;
  animalEmoji: string;
  animalName: string;
}

// 表示例: Step 2: 住まい情報 (🦫 ビーバー - 家づくりの達人)
```

#### NavigationButtons

```tsx
interface NavigationButtonsProps {
  onBack?: () => void;
  onNext: () => void;
  isLastStep: boolean;
  isValid: boolean;
}
```

### 5.2 入力コンポーネント

#### SelectableCard

```tsx
interface SelectableCardProps {
  value: string;
  label: string;
  icon?: string;
  description?: string;
  selected: boolean;
  onSelect: (value: string) => void;
}
```

#### ChildrenInput（動的フォーム）

```tsx
interface ChildrenInputProps {
  children: Child[];
  onAdd: () => void;
  onRemove: (index: number) => void;
  onChange: (index: number, child: Child) => void;
  maxChildren: number;  // 10
}
```

---

## 6. データスキーマ

### 6.1 ユーザープロファイル

```typescript
interface UserOnboardingProfile {
  // Step 1
  age: number;
  employmentType: EmploymentType;

  // Step 2
  residenceType: ResidenceType;
  region?: string;  // 都道府県コード

  // Step 3
  householdType: HouseholdType;
  hasSpouse: boolean;
  children: Child[];

  // Step 4
  plannedEvents: PlannedEvent[];
  email?: string;
  emailNotificationEnabled: boolean;

  // メタデータ
  createdAt: Date;
  updatedAt: Date;
  onboardingCompleted: boolean;
}
```

### 6.2 APIエンドポイント

```
POST /api/onboarding/profile
  - プロファイル保存
  - Body: UserOnboardingProfile

GET /api/onboarding/status
  - オンボーディング状態確認

PATCH /api/onboarding/profile
  - プロファイル部分更新

GET /api/recommendations
  - プロファイルに基づくおすすめ情報取得
```

---

## 7. セキュリティ要件

### 7.1 データ保護

| 項目 | 対策 |
|------|------|
| 個人情報暗号化 | AES-256-GCM（CISO設計済み） |
| 通信暗号化 | TLS 1.3 |
| アクセス制御 | RBAC（CASL実装済み） |
| 監査ログ | 全操作を記録 |

### 7.2 プライバシー配慮

| 項目 | 対策 |
|------|------|
| 最小限の収集 | 必須項目を限定 |
| 目的の明示 | 各項目の使用目的を表示 |
| 同意取得 | プライバシーポリシー同意チェック |
| 削除権 | ユーザー自身でデータ削除可能 |

---

## 8. アクセシビリティ

### 8.1 WCAG 2.1 AA準拠

| 項目 | 対応 |
|------|------|
| キーボード操作 | Tab/Enter/矢印キーでの完全操作 |
| スクリーンリーダー | ARIA属性の適切な設定 |
| コントラスト比 | 4.5:1 以上 |
| フォーカス表示 | 明確なフォーカスインジケーター |
| エラー表示 | 音声読み上げ対応のエラーメッセージ |

### 8.2 多言語対応（将来拡張）

- 日本語（デフォルト）
- 英語
- 中国語（簡体字/繁体字）

---

## 9. 実装タスク

### Phase 1: 基本実装

| タスク | 担当 | 優先度 |
|--------|------|--------|
| 共通コンポーネント作成 | App Engineer | P0 |
| Step 1-4 画面実装 | App Engineer | P0 |
| バリデーションロジック | App Engineer | P0 |
| API エンドポイント実装 | App Engineer | P0 |

### Phase 2: 統合・テスト

| タスク | 担当 | 優先度 |
|--------|------|--------|
| 法令API連携 | App Engineer | P1 |
| 動物アイコン・イラスト実装 | App Engineer | P1 |
| E2Eテスト作成 | App Engineer | P1 |
| セキュリティレビュー | CISO/White Hacker | P1 |

### Phase 3: 最適化

| タスク | 担当 | 優先度 |
|--------|------|--------|
| アニメーション追加 | App Engineer | P2 |
| A/Bテスト準備 | CMO | P2 |
| パフォーマンス最適化 | App Engineer | P2 |

---

## 10. 承認欄

| 役職 | 承認 | 日付 | コメント |
|------|------|------|----------|
| CTO | □ | | |
| CISO | □ | | |
| App Engineer | □ | | |

---

**文書終了**

*本設計書は need/need-new.txt の要件および docs/Laws_API_Integration_Proposal.md と連携して作成されました。*
